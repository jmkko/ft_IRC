<!DOCTYPE html>
<html lang="Eng">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>// HAZARDOUS - IRC server//</title>
	<!-- STYLES --> 
	<link href="style.css" rel="stylesheet">
	<!-- <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet"> -->

	<!-- JAVASCRIPT -->
	<!-- <script src="p5/includes/p5.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.min.js"></script>
	<script src="Cell.js"></script>
	<script src="Grid.js"></script>
	<script src="PerlinFog.js" id="sketch"></script>
	<script>
		let max_width = 9999;
    let img;
		const options = {cellSize: 5};

		function p5_start(sketch) {
			if (p5_sketch) {
				p5_sketch.remove(); // Remove old sketch
			}
			p5_sketch = new p5(sketch, options);
		}

		//customize PerlinFog sketch
		// const options = { cellSize: Math.floor(window.innerWidth * 0.01) };

		function PerlinFog_index(p, options) {

      p.preload = function() {
      img = p.loadImage(
        'hazardousirc.png',
        // success callback
        () => console.log("✅ Image loaded successfully"),
        // error callback
        (err) => {
          console.warn("⚠️ Could not load image:", err);
          img = null; // fallback so the rest of the sketch keeps working
        }
      );
    };
			// Call the original function to set up everything
			const original = PerlinFog(p, options);
			// Override the printText function
			p.printText = function(grid) {
				grid.buffer.background(255);
				let fontSize = p.floor(0.093 * window.innerWidth - 1.65);
				let imgPosH = p.floor(0.093 * window.innerHeight - 1.65);
				let heightDiff = fontSize - (fontSize / 2);
        if (img) {
          grid.img_to_buffer(img, window.innerWidth / 2 - (3 * img.width)  / 2, imgPosH - fontSize + 20);
          grid.buffer_to_grid(110, "title");
        }
				grid.text_to_buffer("HAZARDOUS","center", 0, -heightDiff + 160, fontSize);
				grid.text_to_buffer("- IRC server -","center", 0, heightDiff + 160, fontSize * 0.8);
				grid.buffer_to_grid(180, "title");
			};

			p.handleClick = function(grid, mouse) {
				for (let cell of grid.cells) {
					if (mouse.dist(cell.realPos) < 190 && cell.group == "title") {
						window.location.href = "html/index.html";
						break ;
					}
				}
			}
			p.touchEnded = function () {
				p.handleClick(grid, mouse);
				return false; // Prevent default iOS behavior like double-tap zoom
			};

			return original;
		}

		window.onload = function () {
			new p5(PerlinFog_index, 'background'); 
		};
	</script>

</head>

<body>
		<div id="background" style="pointer-events: auto; touch-action: auto; -webkit-user-select: none; -webkit-tap-highlight-color: transparent;"></div>
</body>

</html>
